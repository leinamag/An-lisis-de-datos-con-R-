---
title: "Reporte de Analisis Detallado"
author: "Carlos Merino"
date: "`r format(Sys.time(), '%d de %B, %Y')`"
output:
  pdf_document:
    toc: true
    latex_engine: xelatex
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: cerulean
params: []
---
 
```{r setup, include=FALSE}
# 1. CARGA DE LIBRER√çAS
library(tidyverse)
library(janitor)
library(knitr)
library(dplyr) 
library(broom)
library(ggplot2)
library(janitor)
library(broom)

# 2. OPCIONES GLOBALES DEL CHUNK
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE, 
                      fig.align = 'center', 
                      fig.width = 7, 
                      fig.height = 5)

# 3. CARGA DE DATOS 
data <- read_csv("student_exam_scores.csv")
```

# - üîç Extracci√≥n e Importaci√≥n de Datos

La metodolog√≠a de obtenci√≥n y carga de datos se realiz√≥ en los siguientes pasos:

## - üíæ Extracci√≥n de la Fuente

Primero se descargan los datos desde https://www.kaggle.com/ , escogiendo la base de datos "student_exam_scores.csv".
Luego se guarda escogiendo cualquier directorio de alguna carpeta, en este caso, se escogio la ruta:
```
"C:/Users/carlo/Desktop/Proyectos propios/analisis con reporte de datos/Reporte de Datos/student_exam_scores.csv".
```

## - üìÇ Importaci√≥n a R

Despues se importa esta base de datos al entorno de R con el siguiente codigo:

```
data <- read_csv("student_exam_scores.csv")

```
Donde:

```{r codigo_importado, echo=FALSE, results='asis'}

cat("
| Elemento | Tipo | Descripci√≥n |
| :--- | :--- | :--- |
| **`data`** | Objeto | Es el nombre con el que guardaremos esta base de datos. |
| **`read_csv()`** | Funci√≥n | Funci√≥n que lee archivos en formato CSV, reconociendo los tipos de datos de las columnas. |
| **`(student_exam...)`** | Directorio | Ubicacion del archivo |
")
```

# - üßπ Limpieza basica y estandarizacion

Este an√°lisis se basa en el conjunto de datos de puntajes estudiantiles, el cual se ha limpiado y estandarizado.

## - üõ†Ô∏è Carga de Librer√≠as
Para la estandarizaci√≥n de nombres de columnas, se utiliz√≥ la librer√≠a janitor.

## - üß™Ô∏è Proceso de Estandarizaci√≥n
Se aplic√≥ la funci√≥n clean_names() para estandarizar los nombres de todas las columnas, y la funci√≥n mutate() para asegurar el formato de la variable clave del estudiante.

El c√≥digo utilizado fue:

```{r limpieza_datos, echo=TRUE}
data <- data %>%
  janitor::clean_names() %>% 
  mutate(student_id = as.character(student_id))
```
Donde:

```{r codigo_datos, echo=FALSE, results='asis'}

cat("
| Elemento | Tipo | Descripci√≥n |
| :--- | :--- | :--- |
| **`data`** | Objeto | Estandariza los nombres de todas las columnas (ej. de 'Previous Scores' a 'previous_scores'). |
| **`janitor::clean_names()`** | Limpieza | Funci√≥n que lee archivos en formato CSV, reconociendo los tipos de datos de las columnas. |
| **`mutate()`** | Transformaci√≥n | Modifica la columna student_id para asegurar que se almacene como un car√°cter. |
")
```

# - üìä Exploracion inicial y estadistica descriptiva

Esta etapa se realiza sobre el conjunto de datos transformado (data_clean) para obtener un primer vistazo a la estructura, validar el tipo de dato de las nuevas variables y resumir las caracter√≠sticas centrales de las variables num√©ricas.

## - üìÑ glimpse(data_clean)

La funci√≥n glimpse() proporciona un resumen conciso de las filas, columnas y, lo m√°s importante, el tipo de dato de cada variable (dbl, chr). Esto confirma que las transformaciones (como la de student_id a car√°cter) se realizaron correctamente.

```{r glimpse(data_clean), echo=TRUE}
glimpse(data)
```

## - üèÜ summary(data_clean)

La funci√≥n summary() es crucial, ya que calcula m√©tricas descriptivas esenciales (media, mediana, cuartiles) para las variables continuas.

```{r summary(data_clean), echo=TRUE}
summary(data)
```

## - üí° head(data_clean)

La funci√≥n head() permite visualizar las primeras filas del dataset. Esto sirve como una validaci√≥n r√°pida para asegurar que las nuevas variables categ√≥ricas (pass_fail, previos_cat) se han creado con los valores esperados.

```{r head(data_clean), echo=TRUE}
head(data)
```

# - üìù Transformacion de los datos a traves de variables nuevas

A partir del dataset limpio, se crean seis nuevas variables categ√≥ricas y de ratio (como el nivel de aprobaci√≥n, el nivel previo y el balance estudio/sue√±o) esenciales para el an√°lisis de rendimiento.

```{r transformacion_datos, echo=TRUE}
data_clean <- data %>% 
  mutate(
    study_per_sleep = hours_studied / sleep_hours,
    previos_cat = case_when(
      previous_scores >= 80 ~ "Alto",
      previous_scores >= 60 ~ "Medio",
      TRUE ~ "Bajo"
    ),
    exam_level = case_when(
      exam_score >= 40 ~ "Alto",
      exam_score >= 30 ~ "Medio",
      TRUE ~ "Bajo"
    ),
    pass_fail = if_else(exam_score >= 30, "Aprobado", "Reprobado"),
    exam_zscore = (exam_score - mean(exam_score, na.rm = TRUE)) / sd(exam_score, na.rm = TRUE),
    exam_percentile = percent_rank(exam_score) * 100
  )
```

Donde:

```{r transformacion_dato, echo=FALSE, results='asis'}

cat("
| Elemento | Tipo | Descripci√≥n |
| :--- | :--- | :--- |
| **`student_id`** | Car√°cter | Asegura que el ID sea tratado como texto, no como valor num√©rico. |
| **`study_per_sleep`** | Ratio (Num√©rico) | Mide el balance entre el tiempo dedicado al estudio y el descanso (clave para el gr√°fico de burbujas). |
| **`previos_cat`** | Categ√≥rica | Clasifica el historial acad√©mico en Alto, Medio o Bajo para an√°lisis comparativos. |
| **`exam_level`** | Categ√≥rica | Clasifica el puntaje del examen en Alto, Medio o Bajo. |
| **`pass_fail`** | Binaria | Determina el estado de aprobaci√≥n/reprobaci√≥n (Aprobado >= 30, Reprobado < 30). Crucial para la correlaci√≥n. |
| **`exam_zscore`** | Num√©rico | Estandariza el puntaje para medir qu√© tan lejos est√° de la media general. |
| **`exam_percentile`** | Num√©rico | Mide el porcentaje de estudiantes que obtuvieron un puntaje igual o inferior. |
")
```


# - Graficos de ggplot2

## - üìà Histograma üìâ

El **histograma** a continuaci√≥n muestra la distribuci√≥n de la frecuencia de los puntajes obtenidos, con una l√≠nea vertical indicando la **media general** del examen. Esto permite identificar r√°pidamente la concentraci√≥n de resultados.

```{r plot_g1, echo=FALSE, fig.cap="Gr√°fico de Histograma: Relaci√≥n entre Frecuencias y Puntaje", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = exam_score)) +
  geom_histogram(binwidth = 5, fill = "#F6CFFF", color = "black", alpha = 1) +
  geom_vline(aes(xintercept = mean(exam_score)), color = "red", linetype = "solid", linewidth = 1.2) +
  annotate("text", x = mean(data_clean$exam_score) + 0.5, y = 56,
           label = paste("üìä Media:", round(mean(data_clean$exam_score), 1)),
           color = "orange", hjust = 0, size = 5) +
  labs(title = "üìù Distribuci√≥n de puntajes del examen",
       subtitle = "üîç Incluye l√≠nea de referencia de la media general",
       x = "üìå Puntaje del examen", y = "üé® Frecuencia") +
  theme_minimal(base_size = 14) +
  theme(plot.title = element_text(face = "bold", color = "#2c3e50", hjust = 0.4),
        plot.subtitle = element_text(color = "#7f8c8d", hjust = 0.4),
        axis.title.x = element_text(color = "blue", face = "bold"),
        axis.title.y = element_text(color = "purple", face = "bold"),
        panel.grid.minor = element_blank()
        )
```

## - üåä Densidad por categor√≠a de aprobaci√≥n üìä

El **gr√°fico de densidad** compara las distribuciones de puntajes para los estudiantes que **Aprobaron** y **Reprobaron**. La densidad es clave para visualizar la separaci√≥n entre ambos grupos respecto al umbral de aprobaci√≥n.

```{r plot_g2, echo=FALSE, fig.cap="Gr√°fico de Densidad: Relaci√≥n entre estado de aprobaci√≥n", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = exam_score, fill = pass_fail)) +
  geom_density(alpha = 1) +
  geom_vline(xintercept = 30.8, linetype = "dashed", color = "black", linewidth = 1) +
  labs(title = "üìä Distribuci√≥n de densidad por estado de aprobaci√≥n",
       subtitle = "üìù Aprobados vs Reprobados",
       x = "üìå Puntaje del examen", y = "üìà Densidad", fill = "üéØ Estado") +
  scale_fill_manual(
    values = c("Aprobado" = "#89FF73", "Reprobado" = "#E86658"),
    labels = c("Aprobado ‚úÖ", "Reprobado ‚ùå"))+
  theme_minimal(base_size = 14) +
  theme(legend.position = "top",
        plot.title = element_text(color = "#A11B7C", face = "bold", hjust = 0.5),
        plot.subtitle = element_text(color = "#35F3FC", face = "bold", hjust = 0.5),
        axis.title.x = element_text(color = "#E566FF", face = "bold", hjust = 0.5),
        axis.title.y = element_text(color = "#EBA50C", face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", color = "#6E5412"),
        legend.text = element_text(size = 12, color = "black"))
```

## - üì¶ Boxplot üéì

Este **gr√°fico de cajas y bigotes (Boxplot)** eval√∫a la distribuci√≥n del puntaje del examen actual segmentado por la **categor√≠a de puntaje previo** (Bajo, Medio, Alto). La caja muestra la mediana y los cuartiles de cada grupo.

```{r plot_g3, echo=FALSE, fig.cap="Gr√°fico de Boxplot: Distribuci√≥n de puntajes", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = previos_cat, y = exam_score, fill = previos_cat)) +
  geom_boxplot(alpha = 0.8, outlier.color = "#E53935", outlier.size = 2) +
  stat_summary(fun = mean, geom = "point", shape = 17, size = 3, color = "black") +
  labs(title = "üì¶ Distribuci√≥n de puntajes por nivel acad√©mico previo",
       subtitle = "üìä An√°lisis de rendimiento seg√∫n historial acad√©mico",
       x = "üìÇ Categor√≠a previa", y = "üìù Puntaje del examen", fill = "Categor√≠a") +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.title = element_text(face = "bold", color = "#5055F2", hjust = 0.5),
    plot.subtitle = element_text(face = "bold", color = "#06D4D2", hjust = 0.5),
    axis.title.x = element_text(face = "bold", color = "#3BFF61", hjust = 0.5),
    axis.title.y = element_text(face = "bold", color = "#498C0D", hjust = 0.5),
    legend.title = element_text(face = "bold", color = "#CC2F49"),
    legend.text = element_text(face = "bold"))
```

## - üîó Gr√°fico de dispersi√≥n üéØ

El **gr√°fico de dispersi√≥n** a continuaci√≥n muestra la fuerte **correlaci√≥n positiva** entre la cantidad de horas dedicadas al estudio y el puntaje obtenido en el examen, diferenciando la tendencia por el resultado final (Aprobado/Reprobado).

```{r plot_g4, echo=FALSE, fig.cap="Gr√°fico de Dispersi√≥n: Relaci√≥n entre horas estudiadas y puntaje del examen", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = hours_studied, y = exam_score, color = pass_fail)) +
  geom_point(alpha = 0.7, size = 2, shape = 15) +
  geom_smooth(method = "lm", se = FALSE, aes(group = pass_fail), linewidth = 1.2) +
  geom_hline(yintercept = 30, linetype = "dashed", color = "#7f8c8d", alpha = 0.7) +
  labs(title = "üìà Relaci√≥n entre Horas Estudiadas y Puntaje del Examen",
       subtitle = "üîç Correlaci√≥n estudio-rendimiento diferenciado por resultado",
       x = "‚è∞ Horas Estudiadas", y = "üéØ Puntaje del Examen", color = "üèÜ Resultado") +
  scale_color_manual(values = c("Aprobado" = "#4CAF50", "Reprobado" = "#F44336"),
                     labels = c("Aprobado ‚úÖ", "Reprobado ‚ùå")) +
  theme_minimal(base_size = 11) +
  theme(
    legend.position = "top",
    plot.title = element_text(face = "bold", color = "#2E1FED", hjust = 0.5),
    plot.subtitle = element_text(face = "bold", color = "#388DE8", hjust = 0.5),
    axis.title.x = element_text(face = "bold", color = "#67E668", hjust = 0.5),
    axis.title.y = element_text(face = "bold", color = "#40692F", hjust = 0.5),
    legend.title = element_text(face = "bold", color = "darkblue", hjust = 0.5),
    legend.text = element_text(face = "bold"),
    legend.background = element_rect(fill = "#FFC9C9", color = NA)
  )
```

## - üî¢ Gr√°fico de barras üë•

El **gr√°fico de barras** muestra la **frecuencia absoluta y relativa** de estudiantes clasificados en los niveles de desempe√±o (Bajo, Medio, Alto) creados a partir del puntaje final del examen.

```{r plot_g5, echo=FALSE, fig.cap="Gr√°fico de Barras: Distribuci√≥n de Estudiantes por Nivel de Examen", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = exam_level, fill = exam_level)) +
  geom_bar(alpha = 0.8, color = "white", linewidth = 0.4) +
  geom_text(stat = 'count', aes(label = after_stat(count)), 
            vjust = -0.5, size = 4, fontface = "bold", color = "black") +
  geom_text(stat = 'count', 
            aes(label = paste0(round(after_stat(count)/nrow(data_clean)*100, 1), "%")),
            vjust = 1.5, size = 4, fontface = "bold", color = "white") +
  labs(title = "üìä Distribuci√≥n de Estudiantes por Nivel de Examen",
       subtitle = "üèÜ Clasificaci√≥n seg√∫n desempe√±o en la evaluaci√≥n",
       x = "üéØ Nivel de Examen", y = "üë• Cantidad de Estudiantes", fill = "Nivel") +
  scale_fill_brewer(palette = "Set1") +
  scale_x_discrete(limits = c("Bajo", "Medio", "Alto")) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.title = element_text(color = "#F28500",face = "bold", hjust = 0.5),
    plot.subtitle = element_text(color = "#FF00C0", hjust = 0.5),
    axis.title.x = element_text(color = "#87F0FF", face = "bold"),
    axis.title.y = element_text(color = "#DE6EFA", face = "bold"),
  )
```

## - ‚öñÔ∏è An√°lisis del ratio estudio/sue√±o üåô

El **gr√°fico de burbujas** eval√∫a el **balance entre horas estudiadas y horas de sue√±o (Ratio)** en relaci√≥n con el puntaje. El **tama√±o de las burbujas** representa las horas de sue√±o, indicando si el descanso es un factor clave en el rendimiento final.

```{r plot_g6, echo=FALSE, fig.cap="Gr√°fico de An√°lisis: ratio estudio/sue√±o", fig.width=8, fig.height=5}
ggplot(data_clean, aes(x = study_per_sleep, y = exam_score)) +
  geom_point(aes(color = pass_fail, size = sleep_hours), alpha = 0.6, shape = 16) +
  geom_hline(yintercept = 30, linetype = "dashed", color = "#7f8c8d", alpha = 0.7) +
  geom_vline(xintercept = 1, linetype = "dotted", color = "#7f8c8d", alpha = 0.7) +
  annotate("text", x = max(data_clean$study_per_sleep), y = 30, 
           label = "Umbral de Aprobaci√≥n (30)", color = "#7f8c8d", hjust = 1, fontface = "bold") +
  annotate("text", x = 1, y = max(data_clean$exam_score), 
           label = "Ratio 1:1 (Equilibrio)", color = "#7f8c8d", vjust = -0.5, fontface = "bold") +
  labs(title = "‚öñÔ∏è Impacto del Balance Estudio-Sue√±o en el Rendimiento",
       subtitle = "‚óè Color = Resultado | ‚óè Tama√±o = Horas de Sue√±o",
       x = "üìä Ratio Horas Estudiadas / Horas de Sue√±o", y = "üéØ Puntaje del Examen",
       color = "üèÜ Resultado", size = "üò¥ Horas de Sue√±o") +
  scale_color_manual(
    values = c("Aprobado" = "#4CAF50", "Reprobado" = "#F44336"),
    labels = c("Aprobado ‚úÖ", "Reprobado ‚ùå")) +
  scale_size_continuous(range = c(1, 6), breaks = seq(4, 10, 2)) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.title = element_text(color = "#FA4674", face = "bold", hjust = 0.5),
    plot.subtitle = element_text(color = "#088F06", face = "bold", hjust = 0.5),
    axis.title.x = element_text(color = "#9191FF", face = "bold", hjust = 0.5),
    axis.title.y = element_text(color = "#C608FC", face = "bold", hjust = 0.5),
    legend.title = element_text(face = "bold", color = "#A6A663"),
    legend.text = element_text(face = "bold", color = "#2c3e50"),
    legend.background = element_rect(fill = "#f8f9fa"))
```
